<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Astrales</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <!-- Форма входа/регистрации -->
        <div id="loginForm" class="login-container">
            <div class="login-card">
                <h1 class="login-title">Astrales</h1>
                <p class="login-subtitle">Перед тем как начать, создайте аккаунт</p>
                
                <!-- Переключатель режимов -->
                <div class="mode-switcher">
                    <button class="mode-btn active" onclick="switchMode('login')" id="loginModeBtn">Войти</button>
                    <button class="mode-btn" onclick="switchMode('register')" id="registerModeBtn">Зарегистрироваться</button>
                </div>
                
                <!-- Форма входа -->
                <form class="login-form" id="loginFormElement" onsubmit="handleLogin(event)">
                    <div class="input-group">
                        <input
                            type="text"
                            id="username"
                            placeholder="Имя пользователя"
                            class="login-input"
                            required
                        />
                    </div>
                    
                    <div class="input-group">
                        <input
                            type="password"
                            id="password"
                            placeholder="Пароль"
                            class="login-input"
                            required
                        />
                    </div>
                    
                    <button type="submit" class="login-button" id="submitBtn">
                        Войти
                    </button>
                </form>
                
                <!-- Форма регистрации -->
                <form class="login-form hidden" id="registerFormElement" onsubmit="handleRegister(event)">
                    <div class="input-group">
                        <input
                            type="text"
                            id="regUsername"
                            placeholder="Имя пользователя"
                            class="login-input"
                            required
                        />
                    </div>
                    
                    <div class="input-group">
                        <input
                            type="password"
                            id="regPassword"
                            placeholder="Пароль"
                            class="login-input"
                            required
                        />
                    </div>
                    
                    <div class="input-group">
                        <input
                            type="password"
                            id="confirmPassword"
                            placeholder="Подтвердите пароль"
                            class="login-input"
                            required
                        />
                    </div>
                    
                    <button type="submit" class="login-button" id="registerSubmitBtn">
                        Зарегистрироваться
                    </button>
                </form>
                
                <!-- Сообщение об ошибке -->
                <div id="errorMessage" class="error-message hidden"></div>
            </div>
        </div>

        <!-- Список чатов -->
        <div id="chatList" class="chat-list-container hidden">
            <div class="chat-header">
                <h2>Чаты</h2>
                <div class="profile-section">
                    <div class="profile-avatar" onclick="toggleProfileMenu()">
                        <img id="userAvatar" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjAiIGN5PSIyMCIgcj0iMjAiIGZpbGw9IiM0NDQ0NDQiLz4KPHBhdGggZD0iTTIwIDEwQzIyLjA5IDEwIDI0IDExLjkxIDI0IDE0QzI0IDE2LjA5IDIyLjA5IDE4IDIwIDE4QzE3LjkxIDE4IDE2IDE2LjA5IDE2IDE0QzE2IDExLjkxIDE3LjkxIDEwIDIwIDEwWiIgZmlsbD0iI0ZGRkZGRiIvPgo8cGF0aCBkPSJNMjAgMjBDMTYuNjkgMjAgMTQgMjIuNjkgMTQgMjZIMjZDMjYgMjIuNjkgMjMuMzEgMjAgMjAgMjBaIiBmaWxsPSIjRkZGRkZGIi8+Cjwvc3ZnPgo=" alt="Avatar">
                        <div class="edit-icon">✏️</div>
                    </div>
                    <div id="profileMenu" class="profile-menu hidden">
                        <div class="profile-menu-item" onclick="openProfileSettings()">
                            <span>Настройки профиля</span>
                        </div>
                        <div class="profile-menu-item" onclick="handleLogout()">
                            <span>Выйти</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="search-section">
                <div class="search-container">
                    <input
                        type="text"
                        id="searchInput"
                        placeholder="Поиск пользователей..."
                        class="search-input"
                        oninput="handleSearch(event)"
                    />
                </div>
            </div>

            <!-- Результаты поиска -->
            <div id="searchResults" class="search-results hidden">
                <div class="search-results-header">
                    <h3>Результаты поиска</h3>
                    <button class="close-search" onclick="closeSearchResults()">×</button>
                </div>
                <div id="searchResultsList" class="search-results-list">
                    <!-- Результаты поиска будут добавляться сюда -->
                </div>
            </div>

            <!-- Список чатов -->
            <div id="chatsList" class="chats-list">
                <div class="empty-state">
                    <p class="empty-text">Здесь как то пустовато...</p>
                </div>
            </div>
        </div>

        <!-- Чат с пользователем -->
        <div id="userChat" class="user-chat hidden">
            <div class="chat-header">
                <div class="chat-user-info">
                    <img id="chatUserAvatar" src="" alt="User Avatar" class="chat-user-avatar" onclick="openUserProfileModal()">
                    <div class="chat-user-details">
                        <h3 id="chatUserName">Имя пользователя</h3>
                        <span class="online-status">В сети</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="call-button" onclick="makeCall()" title="Позвонить">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M22 16.92V19.92C22.0011 20.1985 21.9441 20.4742 21.8325 20.7294C21.7209 20.9846 21.5573 21.2136 21.352 21.4019C21.1467 21.5902 20.9046 21.7335 20.6407 21.8227C20.3768 21.9119 20.0973 21.9452 19.82 21.92C16.7428 21.5856 13.787 20.5341 11.19 18.85C8.77382 17.3146 6.72533 15.2661 5.18999 12.85C3.49997 10.2412 2.44824 7.27099 2.11999 4.18C2.09494 3.90347 2.12787 3.62476 2.21649 3.36162C2.30512 3.09849 2.44756 2.85726 2.63466 2.65262C2.82176 2.44799 3.04934 2.28477 3.30301 2.17328C3.55668 2.06179 3.83106 2.00462 4.10999 2.005H7.10999C7.59522 1.99522 8.06579 2.16708 8.43376 2.48353C8.80173 2.79999 9.04201 3.23945 9.10999 3.72C9.23662 4.68007 9.47144 5.62273 9.80999 6.53C9.94454 6.88792 9.97345 7.27675 9.89382 7.65382C9.81419 8.03088 9.62877 8.38128 9.35999 8.67L8.08999 9.94C9.51355 12.0795 11.4505 14.0165 13.59 15.44L14.86 14.17C15.1487 13.9012 15.4991 13.7158 15.8762 13.6362C16.2532 13.5566 16.6421 13.5855 17 13.72C17.9073 14.0586 18.8499 14.2934 19.81 14.42C20.2905 14.4879 20.7299 14.7282 21.0464 15.0962C21.3628 15.4641 21.5347 15.9347 21.525 16.42L22 16.92Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <button class="back-button" onclick="backToChats()">← Назад</button>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="empty-chat">
                    <p>Пока что тут пустоватенько, может надо написать?</p>
                </div>
            </div>

            <div class="chat-input-section">
                <div class="chat-input-container">
                    <input
                        type="text"
                        id="messageInput"
                        placeholder="Напишите сообщение..."
                        class="message-input"
                        onkeypress="handleMessageKeyPress(event)"
                    />
                    <button class="send-image-button" onclick="openImageUpload()" title="Отправить файл">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    
                    <button class="send-button" onclick="sendMessage()">Отправить</button>
                </div>
                <input type="file" id="imageUpload" accept="*/*" style="display: none;" onchange="handleFileUpload(event)">
            </div>
        </div>

        <!-- Модальное окно настроек профиля -->
        <div id="profileModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Настройки профиля</h3>
                    <button class="close-button" onclick="closeProfileSettings()">×</button>
                </div>
                <div class="modal-body">
                    <div class="avatar-section">
                        <div class="current-avatar">
                            <img id="modalAvatar" src="" alt="Current Avatar">
                        </div>
                        <div class="avatar-actions">
                            <label for="avatarUpload" class="upload-button">
                                Загрузить аватар
                            </label>
                            <input type="file" id="avatarUpload" accept="image/*" style="display: none;" onchange="handleAvatarUpload(event)">
                        </div>
                    </div>
                    <div class="username-section">
                        <label for="newUsername">Имя пользователя:</label>
                        <input type="text" id="newUsername" class="username-input" placeholder="Введите новое имя">
                        <button class="save-button" onclick="saveProfileChanges()">Сохранить</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Модальное окно профиля пользователя -->
        <div id="userProfileModal" class="modal hidden">
            <div class="modal-content user-profile-modal">
                <div class="modal-header">
                    <h3>Профиль пользователя</h3>
                    <button class="close-button" onclick="closeUserProfileModal()">×</button>
                </div>
                <div class="modal-body">
                    <div class="user-profile-avatar">
                        <img id="userProfileAvatar" src="" alt="User Avatar">
                    </div>
                    <div class="user-profile-info">
                        <h4 id="userProfileUsername">Имя пользователя</h4>
                        <div class="user-profile-status">
                            <span class="status-indicator" id="userProfileStatusIndicator"></span>
                            <span id="userProfileStatusText">В сети</span>
                        </div>
                    </div>
                    <div class="user-profile-actions">
                        <button class="message-user-btn" onclick="closeUserProfileModal()">
                            Написать сообщение
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Модальное окно входящего звонка -->
        <div id="incomingCallModal" class="modal hidden">
            <div class="modal-content incoming-call-modal">
                <div class="incoming-call-header">
                    <h3>Входящий звонок</h3>
                </div>
                <div class="incoming-call-body">
                    <div class="caller-avatar">
                        <img id="callerAvatar" src="" alt="Caller Avatar">
                    </div>
                    <div class="caller-info">
                        <h4 id="callerName">Имя пользователя</h4>
                        <p>Вам звонит <span id="callerUsername"></span></p>
                    </div>
                    <div class="call-actions">
                        <button class="accept-call-button" onclick="acceptCall()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M22 16.92V19.92C22.0011 20.1985 21.9441 20.4742 21.8325 20.7294C21.7209 20.9846 21.5573 21.2136 21.352 21.4019C21.1467 21.5902 20.9046 21.7335 20.6407 21.8227C20.3768 21.9119 20.0973 21.9452 19.82 21.92C16.7428 21.5856 13.787 20.5341 11.19 18.85C8.77382 17.3146 6.72533 15.2661 5.18999 12.85C3.49997 10.2412 2.44824 7.27099 2.11999 4.18C2.09494 3.90347 2.12787 3.62476 2.21649 3.36162C2.30512 3.09849 2.44756 2.85726 2.63466 2.65262C2.82176 2.44799 3.04934 2.28477 3.30301 2.17328C3.55668 2.06179 3.83106 2.00462 4.10999 2.005H7.10999C7.59522 1.99522 8.06579 2.16708 8.43376 2.48353C8.80173 2.79999 9.04201 3.23945 9.10999 3.72C9.23662 4.68007 9.47144 5.62273 9.80999 6.53C9.94454 6.88792 9.97345 7.27675 9.89382 7.65382C9.81419 8.03088 9.62877 8.38128 9.35999 8.67L8.08999 9.94C9.51355 12.0795 11.4505 14.0165 13.59 15.44L14.86 14.17C15.1487 13.9012 15.4991 13.7158 15.8762 13.6362C16.2532 13.5566 16.6421 13.5855 17 13.72C17.9073 14.0586 18.8499 14.2934 19.81 14.42C20.2905 14.4879 20.7299 14.7282 21.0464 15.0962C21.3628 15.4641 21.5347 15.9347 21.525 16.42L22 16.92Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Принять
                        </button>
                        <button class="decline-call-button" onclick="declineCall()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Отклонить
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Модальное окно исходящего звонка -->
        <div id="outgoingCallModal" class="modal hidden">
            <div class="modal-content outgoing-call-modal">
                <div class="outgoing-call-header">
                    <h3>Звонок</h3>
                </div>
                <div class="outgoing-call-body">
                    <div class="caller-avatar">
                        <img id="outgoingCallAvatar" src="" alt="User Avatar">
                    </div>
                    <div class="caller-info">
                        <h4 id="outgoingCallName">Имя пользователя</h4>
                        <p>Вызываем...</p>
                    </div>
                    <div class="call-actions">
                        <button class="decline-call-button" onclick="cancelOutgoingCall()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Отменить
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Модальное окно активного звонка -->
        <div id="activeCallModal" class="modal hidden">
            <div class="modal-content active-call-modal">
                <div class="active-call-header">
                    <h3>Звонок</h3>
                    <div class="call-timer" id="callTimer">00:00</div>
                </div>
                <div class="active-call-body">
                    <div class="call-participants">
                        <div class="caller-avatar-large">
                            <img id="activeCallAvatar" src="" alt="Caller Avatar">
                        </div>
                        <div class="caller-info-large">
                            <h4 id="activeCallName">Имя пользователя</h4>
                            <p>Разговор активен</p>
                        </div>
                    </div>
                    <div class="call-controls">
                        <button class="mute-button" onclick="toggleMute()" id="muteButton">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 1A3 3 0 0 0 9 4V10A3 3 0 0 0 15 10V4A3 3 0 0 0 12 1Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M19 10V9A7 7 0 0 0 5 9V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12 19V23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M8 23H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                        <button class="end-call-button" onclick="endCall()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Завершить
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Контекстное меню для сообщений -->
    <div id="messageContextMenu" class="message-context-menu hidden">
        <div class="context-menu-item" onclick="deleteMessageForMe()">
            <span>Удалить у меня</span>
        </div>
        <div class="context-menu-item" onclick="deleteMessageForEveryone()">
            <span>Удалить у всех</span>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
